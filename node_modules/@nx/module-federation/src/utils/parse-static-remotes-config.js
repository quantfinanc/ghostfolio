"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseStaticRemotesConfig = parseStaticRemotesConfig;
exports.parseStaticSsrRemotesConfig = parseStaticSsrRemotesConfig;
const path_1 = require("path");
function parseStaticRemotesConfig(staticRemotes, context) {
    if (!staticRemotes?.length) {
        return { remotes: [], config: undefined };
    }
    const config = {};
    for (const app of staticRemotes) {
        const outputPath = context.projectGraph.nodes[app].data.targets['build'].options.outputPath; // dist || dist/checkout
        const basePath = ['', '/', '.'].some((p) => (0, path_1.dirname)(outputPath) === p)
            ? outputPath
            : (0, path_1.dirname)(outputPath); // dist || dist/checkout -> dist
        const urlSegment = app;
        const port = context.projectGraph.nodes[app].data.targets['serve'].options.port;
        config[app] = { basePath, outputPath, urlSegment, port };
    }
    return { remotes: staticRemotes, config };
}
function parseStaticSsrRemotesConfig(staticRemotes, context) {
    if (!staticRemotes?.length) {
        return { remotes: [], config: undefined };
    }
    const config = {};
    for (const app of staticRemotes) {
        let outputPath = context.projectGraph.nodes[app].data.targets['build']
            .options.outputPath;
        outputPath = (0, path_1.dirname)(outputPath); // dist/browser => dist || dist/checkout/browser -> checkout
        const basePath = ['', '/', '.'].some((p) => (0, path_1.dirname)(outputPath) === p)
            ? outputPath
            : (0, path_1.dirname)(outputPath); // dist || dist/checkout -> dist
        const urlSegment = app;
        const port = context.projectGraph.nodes[app].data.targets['serve'].options.port;
        config[app] = { basePath, outputPath, urlSegment, port };
    }
    return { remotes: staticRemotes, config };
}
